package com.odenzo.ripple.models.atoms

import io.circe.Decoder
import io.circe.syntax._
import pprint.PPrinter

import com.odenzo.ripple.models.testkit.CodecTesting
import com.odenzo.ripple.models.utils.caterrors.AppError

class MemosTest extends CodecTesting {

  val json =
    """  [
      |          {
      |            "Memo" : {
      |              "MemoData" : "7B22707265765F68617368223A227872703A2F2F46353936363142423036303041373237364331354145333730363132313246393545463639354132433433384634353532303339423645453244424431454332222C2274696D657374616D70223A22323031392D30372D31395431343A30323A31312E3531305A222C22646174615F6A736F6E223A7B22736967223A7B22616C67223A2265643235353139222C226B6964223A2239677775222C22757365223A22736967222C226B6579223A226B777878382F355A6877577431363550564B4F5268444F326B62504A74485A32704D4C56796C3435476B673D227D2C22656E63223A7B22616C67223A227832353531392D7873616C736132302D706F6C7931333035222C226B6964223A22326B7738222C22757365223A22656E63222C226B6579223A22356B53312B6D4A6B617A4C54563569635757794D2F7659434264456C7230324275717A64736868745A67303D227D7D2C2261646472657373223A227248576655476F6E7366574D4D34616E646F5777705343616D6F414D317870544762227D",
      |              "MemoType" : "7075626C69636B657973"
      |            }
      |          } ,
      |             {
      |            "Memo" : {
      |              "MemoData" : "7B22707265765F68617368223A227872703A2F2F46353936363142423036303041373237364331354145333730363132313246393545463639354132433433384634353532303339423645453244424431454332222C2274696D657374616D70223A22323031392D30372D31395431343A30323A31312E3531305A222C22646174615F6A736F6E223A7B22736967223A7B22616C67223A2265643235353139222C226B6964223A2239677775222C22757365223A22736967222C226B6579223A226B777878382F355A6877577431363550564B4F5268444F326B62504A74485A32704D4C56796C3435476B673D227D2C22656E63223A7B22616C67223A227832353531392D7873616C736132302D706F6C7931333035222C226B6964223A22326B7738222C22757365223A22656E63222C226B6579223A22356B53312B6D4A6B617A4C54563569635757794D2F7659434264456C7230324275717A64736868745A67303D227D7D2C2261646472657373223A227248576655476F6E7366574D4D34616E646F5777705343616D6F414D317870544762227D",
      |              "MemoType" : "7075626C69636B657973"
      |            }
      |          }
      |     ]   """.stripMargin

  val memojson =
    """
      |  {
      |   "MemoData" : "7B22707265765F68617368223A227872703A2F2F46353936363142423036303041373237364331354145333730363132313246393545463639354132433433384634353532303339423645453244424431454332222C2274696D657374616D70223A22323031392D30372D31395431343A30323A31312E3531305A222C22646174615F6A736F6E223A7B22736967223A7B22616C67223A2265643235353139222C226B6964223A2239677775222C22757365223A22736967222C226B6579223A226B777878382F355A6877577431363550564B4F5268444F326B62504A74485A32704D4C56796C3435476B673D227D2C22656E63223A7B22616C67223A227832353531392D7873616C736132302D706F6C7931333035222C226B6964223A22326B7738222C22757365223A22656E63222C226B6579223A22356B53312B6D4A6B617A4C54563569635757794D2F7659434264456C7230324275717A64736868745A67303D227D7D2C2261646472657373223A227248576655476F6E7366574D4D34616E646F5777705343616D6F414D317870544762227D",
      |              "MemoType" : "7075626C69636B657973"
      |      }
      |
      |        """.stripMargin

  test("Memo List") {
    val res = for {
      decoded <- parseAndDecode(json, Decoder[Memos])
      encoded = (decoded.asJson)
      _       = logger.debug(s"Endoded: ${encoded.asJson.spaces4}")
    } yield (decoded)
    testCompleted(res)
    res.foreach(v => logger.debug(s"Result: ${PPrinter.Color(v)}"))

  }

  test("FromObjects") {
    val memos: Memos = Memos.fromText("Foo").get
    logger.debug(s"JSON ${memos.asJson.spaces4}")
    val memo = memos.memos.head.asJson
    logger.debug(s"First Memo is\n ${memo.asJson.spaces4}")
  }

  test("Memo ") {
    val res: Either[AppError, Memo] = parseAndDecode(memojson, Decoder[Memo])
    val v                           = testCompleted(res)
    logger.debug(s"Result: ${PPrinter.Color(v)}")

  }

  test("Fixture error") {
    val fjson =
      """[
        |                        {
        |                            "Memo" : {
        |                                "MemoData" : "7B2274696D657374616D70223A22323031392D30372D31395431343A30323A31312E3834345A222C22646174615F6A736F6E223A7B2268617368223A227872703A2F2F30303946354342383330373032373743443137373846313239453342363641353832433638394145433634423441303241333738313537434142443930393044227D2C2261646472657373223A227248576655476F6E7366574D4D34616E646F5777705343616D6F414D317870544762227D",
        |                                "MemoType" : "6E6F74696669636174696F6E"
        |                            }
        |                        }
        |                    ]""".stripMargin
    val res = parseAndDecode(fjson, Decoder[Memos])
    testCompleted(res)
  }

}
